@model nethloader.Utils.PaginatedList<nethloader.Models.Image>
@{
    ViewData["Title"] = "Gallery - " + User.Identity.Name;
}

<div class="inner-wrapper flex flex-dc">
    <header class="user-header flex flex-full-center">
        <div class="inner-wrapper--container flex flex-sb">
            <a class="button button--primary button--margin button--padding-long button--header-nav-button pointer flex flex-full-center" data-dialogtrigger="upload"  ripple="ripple" title="Upload an image"><p>Upload</p>
             &nbsp;<svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#upload"></use></svg>
            </a>
            <div class="user-header__user-menu--container flex flex-cross-center flex-sa pointer" data-dropdownelement="user-menu" title="User menu">
                <p class="user-header__user-menu flex flex-full-center" ripple="ripple"><span><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#user-round"></use></svg>&nbsp;@User.Identity.Name</span>&nbsp;<svg class="user-header__user-menu-icon" viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#menu-down"></use></svg></p>
                <div class="user-header__user-menu__dropdown flex flex-full-center" data-dropdownid="user-menu">
                    <ul class="flex flex-dc">
                        <a class="user-header__user-menu__dropdown__link" href="/settings" rel="noopener">
                            <li class="user-header__user-menu__dropdown-item pointer" title="User Control Panel" ripple="ripple">
                                <p class="ta-c"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#settings"></use></svg>&nbsp;User CP</p>
                            </li>
                        </a>
                        <li class="logout-form" title="Log this user out">
                            <form asp-controller="Account" asp-action="Logout" method="post">
                                <button type="submit" class=" ta-c user-header__user-menu__dropdown-item pointer" ripple="ripple"><p><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#exit"></use></svg>&nbsp;Logout</p></button>
                                <input hidden />
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <div class="user-gallery__container flex flex-full-center">
        @if (@Model.Count != 0)
        {
            <div class="inner-wrapper--container content-card content-card--full-height flex flex-dc">
                <div class="user-gallery flex flex-full-center flex-sb" id="user-gallery">
                    @foreach (var i in Model)
                    {
                        <div class="user-gallery__image-container flex flex-full-center flex-dc" id="@i.Id" data-src="@i.Url">
                            <div class="loader"></div>
                            <div class="user-gallery__image__data flex flex-dc flex-sb">
                                <p class="user-gallery__image__data__up-date flex flex-full-center flex-sb">@i.UploadDate.ToString("dd/MM/yyyy - HH:mm") <span class="user-gallery__image__data__delete pointer" data-dialogtrigger="delete" data-delimageid="@i.Id" ripple="ripple" title="Delete this image (forever)"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#delete"></use></svg></span></p>
                                <a class="user-gallery__image__data__icons flex flex-full-center flex-dc" href="/image/view/@i.Id" rel="noopener">
                                    <svg class="big-icon" viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#link"></use></svg>
                                    <p>View image</p>
                                </a>
                            </div>
                        </div>
                    }
                </div>
                <div class="user-gallery__pagination flex flex-full-center">
                @if (Model.HasPreviousPage)
                {
                <a asp-route-page="@(Model.PageIndex - 1)" title="Previous page">
                    <span class="user-gallery__pagination__navigator pointer"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#arrow-right"></use></svg></span>
                </a>
                }
                else
                {
                   <span class="user-gallery__pagination__navigator disabled" title="No previous page available"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#arrow-right"></use></svg></span>
                }
                        <ul class="flex flex-full-center">
                            @for (var i = 1; i <= Model.TotalPages; i++)
                            {
                                @if (Model.PageIndex == @i)
                                {
                                    <li class="user-gallery__pagination-item current-page" title="You are here">@i</li>
                                }
                                else
                                {
                                    <a asp-route-page="@i"><li class="user-gallery__pagination-item pointer" title="Page @i">@i</li></a>
                                }
                            }
                        </ul>
                        @if (Model.HasNextPage)
                        {
                            <a asp-route-page="@(Model.PageIndex + 1)">
                                <span class="user-gallery__pagination__navigator pointer" title="Next page"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#arrow-left"></use></svg></span>
                            </a>
                        }
                        else
                        {
                            <span class="user-gallery__pagination__navigator disabled" title="No next page available"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#arrow-left"></use></svg></span>
                        }
                </div>
            </div>
            }
            else
            {
            <div class="inner-wrapper--container flex flex-full-center flex-dc content-card content-card--full-height">
                <svg class="big-icon" viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#sad-face"></use></svg>
                <p class="user-gallery__no-content ta-c flex flex-dc flex-full-center">It looks like this page is empty</p>
                @if (!Model.HasNextPage && Model.PageIndex != 1)
                {
                    <a asp-route-page="1" class="text--margin">
                        <span class="user-gallery__pagination__navigator pointer"><svg viewBox="0 0 24 24"><use xlink:href="/img/icons.svg#arrow-right"></use></svg>Go back to the first page</span>
                    </a>
                }
            </div>
        }
    </div>

    <!-- Upload image dialog, standalone-->
    <div class="dialog__wrapper flex flex-full-center" data-dialogid="upload">
        <div class="dialog">
            @Html.Partial("../Image/Upload.cshtml")
        </div>
    </div>

    <!-- Delete image dialog, standalone-->
    <div class="dialog__wrapper flex flex-full-center" data-dialogid="delete">
        <div class="dialog">
            @Html.Partial("../Image/Delete.cshtml")
        </div>
    </div>
</div>

<!-- Script loaded here for encapsulation purposes -->
<script async>
    var gallery = document.getElementById('user-gallery');
    if (gallery && gallery.hasChildNodes()) {
        galleryImagesContainers = gallery.children;
        for(let i = galleryImagesContainers.length - 1; i >= 0; i--) {
            let curImg = new Image();
            curImg.classList.add("user-gallery__image");
            curImg.src = galleryImagesContainers[i].dataset.src;
            curImg.onload = () => {
                galleryImagesContainers[i].removeChild(galleryImagesContainers[i].children[0]);
                galleryImagesContainers[i].insertBefore(curImg, galleryImagesContainers[i].firstChild);
            }
        }
    }
</script>